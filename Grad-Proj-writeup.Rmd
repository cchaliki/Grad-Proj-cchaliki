---
title: "Graduate Project"
author: "Catherine Chalikian"
date: "4/21/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

As curious creatures, we often seek to understand how things work. This includes determining causal effects. Statistics has established mathematical methods in this pursuit of identifying cause and effect. However, these methods are only valid when certain assumptions are met. One such assumption is the probabilistic assumption, also called the positivity assumption.

Before we get to the assumption, a little background is necessary. First, we need two groups: a person who is unexposed to the particular treatment is in the control group and has exposure assignment 0, and those who are in the exposed or treatment group have exposure assignment 1. Then, X denotes a vector of possible exposure assignments for every study participant. Each row is a different X. The assignment mechanism captures which group each study participant is assigned. Mathematically, the assignment mechanism is defined as P(X|Z, Y(0), Y(1)), where Y(0) and Y(1) are the potential outcomes under a particular exposure assignment. This is the probability of having a particular set of exposure assignments, and as a probability must be between 0 and 1. Finally, all of the possible exposure assignments must sum to 1. Not every exposure assignment needs to have a probability greater than 0, but the sum of all exposure assignments must sum to 1.

Now, we have established that the assignment mechanism, which looks at a particular set of exposure assignments for all individuals, can be 0, but what about individual assignments? This is where positivity comes into play. The positivity assumption states that each individual must have non-zero probabilities of being assigned to each exposure. 

```{r, echo=FALSE}
printFlag = FALSE
library(tidyverse)
```

```{r}
# create people for study with true causal effect of 1
populate = function(n){
  tibble(
    y0 = rnorm(n,1),
    y1 = y0 + 1
  )
}

set.seed(2)
dat = populate(50)

dat %>%
  summarise(true_causal_effect = mean(y1) - mean(y0))
```
We have generated a dataset with 50 people where the true causal effect is 1. Now let's say that there are only 5 exposure assignments with assignment mechanisms greater than 0 and that the assignment mechanisms have equal probability 0.2. Then, we can select one at random to be our exposure assignment vector.

```{r}
# generate possible exposure assignments X
exp_assmt_func = function(nrow,ncol){
  matrix(sample(c(0,1), replace=T, size = nrow*ncol), nrow = nrow)
}
exp_assmt = exp_assmt_func(5,49)

# add one col of all 0's
exp_assmt = cbind(integer(5), exp_assmt)

# choose X at random
row_num = sample(1:5,1)
x = exp_assmt[row_num,]
```

We will now say that our observed outcome (Y-obs) is the potential outcome based on exposure assignment. So, if a unit has been assigned to control, they have Y-obs = Y(0).

```{r}
# add exposure assignments to data
dat = dat %>% add_column(x)
```

```{r}
# obtain Y-obs
dat = dat %>%
  mutate(y_obs = ifelse(x == 1, y1, y0))

dat %>%
  summarise(observed_causal_effect = mean(y_obs[x == 1]) - 
              mean(y_obs[x == 0]))
```




